{% extends 'layouts/base.njk' %}

{% set title = post.title + ' | Text' %}
{% set usesBlock = true %}

{% set categoriesString = post
  .categories[0]
  .fields
  .title + ' —' if post
  .categories else
    '' %}

{% block content %}
  <main id="main" class="text h-entry l-stack" tabindex="-1" lang={{ post.locale }}>
    <header class="text__header u-floral-heart-gradient">
      <h1 class="main-headline p-name">{{ post.title }}</h1>
      <p class="text__subline type-is-aside">
        {{ categoriesString }}
        <time
          datetime="{{ post.date }}"
          class="dt-published"
        >{{ post.date | displayDate }}</time>
      </p>
      {% if post.contentIntro %}
        <p class="text__intro p-summary">
          {{ post.contentIntro }}
        </p>
      {% endif %}
    </header>
    {% articleImage post.image %}
    <div class="text__body e-content" data-text-body>
      {{ content | safe }}
    </div>
    {%- set currentPostMentions = webmentions | webmentionsForPage(post.permalink) -%}
    {% if currentPostMentions.likes.length %}
      <section
        class="u-global-padding"
        style="grid-column: main;"
        aria-label="Post likes"
      >
        {%- set postMentionCount = webmentions | webmentionCountForPage(post.permalink) -%}
        <h2 class="pagination-navigation__sub-headline type-small-caps">Liked by {{ currentPostMentions.likes.length }} friendly folks.</h2>
        <ul class="webmention-likes">
          {% for post in currentPostMentions.likes %}
            <li><a
              href="{{ post.author.url }}"
              aria-label="Profile of {{ post.author.name }}"
            >
              <img
                src="{{ post.author.photo }}"
                alt="{{ post.author.name }}"
                data-process-image
                data-image-widths="[32, 64]"
                data-image-sizes="2rem"
              >
            </a>
          {% endfor %}
        </ul>
      </section>
    {% endif %}
    {% if hidePaginationNav !== true %}
      <section role="region" class="pagination-navigation text__pagination" aria-labelledby="pgntn-hdln">
        <h2 id="pgntn-hdln" class="small-headline pagination-navigation__headline">Other things I’ve written</h2>
        {% paginationItem 'previous',
        pagination.href.previous,
        articles.ownPosts %}
        {% paginationItem 'next',
        pagination.href.next,
        articles.ownPosts %}
      </section>
    {% endif %}
  </main>
{% endblock %}
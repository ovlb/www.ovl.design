{% extends 'layouts/base.njk' %}

{% set pageTitle = title + ' | Notes' %}
{% set usesBlock = true %}

{% block content %}
  <main id="main" class="note h-entry l-stack" tabindex="-1" lang={{ locale }}>
    <a href="/notes/">Back to archive</a>
    <header class="note-header main-grid-content">
      <aside class="warning">This post is a note. It’s a collection of thoughts, and as such might be incomplete or even wrong. If you think it can be improved, contact me.</aside>
      <h1 class="p-name sub-headline">{{ title }}</h1>
      <p>Note started: {{ date | displayDate(short) }}</p>
      {% if state === 'frozen' %}
        This note is currently {{ state }}. I might get back to it later.
      {% elif state === 'done' %}
        <p>I consider this note done.</p>
      {% elif state === 'evolving' %}
        <p>I’m working on the topic of this note.</p>
        {% if changes %}
          <p>I updated it <a href="#changelog">{{ changes.length }} times</a>.</p>
        {% endif %}
      {% endif %}
    </header>
    <div class="e-content md-content main-grid-content" data-text-body>
      {{ content | safe }}
    </div>
    {%- set currentPostMentions = webmentions | webmentionsForPage(permalink) -%}
    {% if currentPostMentions.likes.length %}
      <section
        class="collections"
        style="grid-column: main;"
        aria-label="Post likes"
      >
        {%- set postMentionCount = webmentions | webmentionCountForPage(permalink) -%}
        <h2 class="pagination-navigation__sub-headline type-all-small-caps">Liked by {{ currentPostMentions.likes.length }} friendly folks.</h2>
        <ul class="webmention-likes">
          {% for post in currentPostMentions.likes %}
            <li><a
              href="{{ post.author.url }}"
              aria-label="Profile of {{ post.author.name }}"
            >
              <img
                src="{{ post.author.photo }}"
                alt="{{ post.author.name }}"
                data-process-image
                data-image-widths="[32, 64]"
                data-image-sizes="2rem"
              >
            </a>
          {% endfor %}
        </ul>
      </section>
    {% endif %}
    <section class="collections">
      <h2 class="pagination-navigation__sub-headline type-all-small-caps">Filed under</h2>
      <ul role="list" class="inline-list">
        {% for collection in tags | getCategories %}
          <li>
            <a
              href="{{ collection | categoryPermalink(categoryBase) }}"
            >
              {{ collection | displayCategory }}
            </a>
          </li>
        {% endfor %}
      </ul>
    </section>
    {% if changes %}
    <section class="collections" aria-labelledby="changelogHdl" id="changelog">
      <h2
        class="pagination-navigation__sub-headline type-all-small-caps"
        id="changelogHdl"
      >Changelog</h2>
      <ul class="changes">
        {% for c in changes %}
          <li class="change">
            <time
              class="change__time"
              datetime="{{ c.date }}"
            >
              {{ c.date | displayDate('short') }}
            </time>
            <h3 class="change__title">
              <a href="{{ c.hash | githubCommit }}">{{ c.message }}</a>
            </h3>
          </li>
        {% endfor %}
      </ul>
    </section>
    {% endif %}
  </main>
{% endblock %}